\documentclass[11pt]{scrartcl} % Font size
\input{../structure.tex} % Include the file specifying the document structure and custom commands

%----------------------------------------------------------------------------------------
%	TITLE SECTION
%----------------------------------------------------------------------------------------

\title{
	\normalfont\normalsize
	\textsc{Harvard Privacy Tools Project}\\ % Your university, school and/or department name(s)
	\vspace{25pt} % Whitespace
	\rule{\linewidth}{0.5pt}\\ % Thin top horizontal rule
	\vspace{20pt} % Whitespace
	{\huge Covariance Sensitivity Proofs}\\ % The assignment title
	\vspace{12pt} % Whitespace
	\rule{\linewidth}{2pt}\\ % Thick bottom horizontal rule
	\vspace{12pt} % Whitespace
}

% \author{\LARGE} % Your name

\date{\normalsize\today} % Today's date (\today) or a custom date

\begin{document}

\maketitle

\section{Preliminaries}

\begin{lemma}
\label{lemma:cancel}
$\forall i,$
$$ \sum_{j=1}^n (x_{ji} - \bar{X}_i) = 0.$$
\end{lemma}

\begin{proof}
\begin{align*}
\sum_{i=1}^n (x_{ji} - \bar{X}_i) &= \sum_{i=1}^n x_{ji} - n \bar{X}_i\\
	&= \sum_{i=1}^n x_{ji} - n\left( \frac{1}{n}\sum_{i=1}^n x_{ji}\right) \\
	&= 0.
\end{align*}
\end{proof}

\begin{lemma}
\label{cov:rewrite}
Let 
$$ f_{ij} = \sum_{k=1}^n (x_{ki} - \bar{X}_i)(x_{kj} - \bar{X}_j),$$
and let $X_i' = X_i \cup \{y_i\}$, and say $X_i$ has size $n$. Let $\bar{X}_i'$ and $\bar{X}_j'$ be the sample means of $X_i'$ and $X_j'$ respectively. Then,
$$ f_{ij}(X') = f_{ij}(X) + n(\bar{X}_i - \bar{X}_i')(\bar{X}_j - \bar{X}_j') + (y_i - \bar{X}_i)(y_j - \bar{X}_j).$$
\end{lemma}

\begin{proof}
Note that
\begin{align*}
f_{ij}(X') &= \sum_{k=1}^{n+1} (x_{ki}' - \bar{X}_i')(x_{kj}' - \bar{X}_j'),\\
	&= \sum_{k=1}^{n} (x_{ki} - \bar{X}_i')(x_{kj} - \bar{X}_j') + (y_i - \bar{X}_i')(y_j - \bar{X}_j'),\\
	&= \sum_{k=1}^{n} \left( (x_{ki} - \bar{X}_i )+ (\bar{X}_i - \bar{X}_i' )\right) \left( (x_{kj} - \bar{X}_j )+ (\bar{X}_j - \bar{X}_j') \right) + (y_i - \bar{X}_i')(y_j - \bar{X}_j'),\\
	&= \sum_{k=1}^{n} (x_{ki} - \bar{X}_i)(x_{kj} - \bar{X}_j) + (\bar{X}_j - \bar{X}_j')\sum_{k=1}^{n} (x_{ki}-\bar{X}_i) + (\bar{X}_i - \bar{X}_i') \sum_{k=1}^{n} (x_{kj} - \bar{X}_j),\\
	& \hspace{1cm} + \sum_{k=1}^{n} (\bar{X}_i - \bar{X}_i')(\bar{X}_j - \bar{X}_j') + (y_i - \bar{X}_i')(y_j - \bar{X}_j'),\\
	&= f_{ij}(X) + n(\bar{X}_i - \bar{X}_i')(\bar{X}_j - \bar{X}_j') + (y_i - \bar{X}_i')(y_j - \bar{X}_j'),
\end{align*}
where the cancellation of the second and third terms in the second-to-last line is due to Lemma \ref{lemma:cancel}.
\end{proof}

\begin{lemma}
\label{lemma:term1bound}
Let  $X_i$ have size $n$ and say $X_i' = X_i \cup \{y_i\}$ where $y_i \in \mathcal{X}_i.$ Say that the space of datapoints $\mathcal{X}_i$ is bounded above by $M_i$ and bounded below by $m_i$, and let $y_i \in \mathcal{X}_i.$ Let  $\bar{X}_i$, $\bar{X}_j$, $\bar{X}_i'$, and $\bar{X}_j'$ be the sample means of $X_i, X_j, X_i'$ and $X_j'$ respectively. Then,
$$ n \left\vert (\bar{X}_i - \bar{X}_i')(\bar{X}_j - \bar{X}_j') \right\vert \le \frac{n}{(n+1)^2}(M_i - m_i)(M_j - m_j).$$
\end{lemma}

\begin{proof}
Note that
\begin{align*}
 n \left\vert (\bar{X}_i - \bar{X}_i')(\bar{X}_j - \bar{X}_j') \right\vert &= n\left\vert \left( \frac{1}{n} \sum_{k=1}^n x_{ki} - \frac{1}{n+1} \sum_{k=1}^{n+1} x_{ki}' \right) \left( \frac{1}{n} \sum_{k=1}^n x_{kj} - \frac{1}{n+1} \sum_{k=1}^{n+1} x_{kj}' \right)\right\vert, \\
 	&= n \left\vert \left( \left(\frac{1}{n} - \frac{1}{n+1}\right) \sum_{k=1}^n x_{ki} - \frac{y_i}{n+1} \right)\left( \left(\frac{1}{n} - \frac{1}{n+1}\right) \sum_{k=1}^n x_{kj} - \frac{y_j}{n+1} \right) \right\vert, \\
	&= n  \left\vert \left(\frac{1}{n(n+1)} \sum_{k=1}^n x_{ki} - \frac{y_i}{n+1} \right)\left( \frac{1}{n(n+1)} \sum_{k=1}^n x_{kj} - \frac{y_j}{n+1} \right) \right\vert, \\
	&= \frac{n}{(n+1)^2} \left\vert \left( \frac{1}{n} \sum_{k=1}^n x_{ki} - \frac{y_i}{n+1} \right)\left( \frac{1}{n} \sum_{k=1}^n x_{kj} - \frac{y_j}{n+1} \right) \right\vert,\\
	&\le \frac{n}{(n+1)^2} (M_i - m_i)(M_j - m_j).
 \end{align*}
\end{proof}

\begin{lemma}
\label{lemma:term2bound}
Let  $X_i$ have size $n$ and say $X_i' = X_i \cup \{y_i\}$ where $y_i \in \mathcal{X}_i.$ Say that the space of datapoints $\mathcal{X}_i$ is bounded above by $M_i$ and bounded below by $m_i$, and let $y_i \in \mathcal{X}_i.$ Let  $\bar{X}_i$, $\bar{X}_j$, $\bar{X}_i'$, and $\bar{X}_j'$ be the sample means of $X_i, X_j, X_i'$ and $X_j'$ respectively. Then,
$$ \left\vert (y_i - \bar{X}_i')(y_j - \bar{X}_j') \right\vert \le \frac{n^2}{(n+1)^2}(M_i - m_i)(M_j-m_j).$$
\end{lemma}

\begin{proof}
Note that
\begin{align*}
 \left\vert (y_i - \bar{X}_i')(y_j - \bar{X}_j') \right\vert &= \left\vert \left( y_i - \frac{y_i + n \bar{X}_i}{n+1}\right) \left( y_j - \frac{y_j + n \bar{X}_j}{n+1}\right) \right\vert, \\
 	&= \frac{1}{(n+1)^2} \left\vert \left((n+1)y_i - y_i - n\bar{X}_i \right)\left((n+1)y_j - y_j - n\bar{X}_j \right) \right\vert, \\
	&= \frac{n^2}{(n+1)^2} \left\vert (y_i - \bar{X}_i)(y_j - \bar{X}_j)\right\vert, \\
	&\le \frac{n^2}{(n+1)^2} (M_i - m_i)(M_j - m_j).
\end{align*}
\end{proof}

\section{Neighboring Definition: Add/Drop One}
\subsection{$\ell_1$-sensitivity}

\begin{theorem}
Let 
$$ f_{ij} (X)= \sum_{k=1}^n (x_{ki} - \bar{X}_i)(x_{kj} - \bar{X}_j).$$
Say that the space of datapoints $\mathcal{X}_i$ is bounded above by $M_i$ and bounded below by $m_i$. Then the
The $\ell_1$-sensitivity of $f(\cdot)$ is bounded by
 $$ \frac{n}{(n+1)}  (M_i - m_i)(M_j - m_j).$$ 
\end{theorem}

\begin{proof}

Adding a point:
\begin{align}
\label{eq:addone}
\left\vert f_{ij}(X') - f_{ij}(X) \right\vert &= \left\vert n(\bar{X}_i - \bar{X}_i')(\bar{X}_j - \bar{X}_j') + (y_i - \bar{X}_i)(y_j - \bar{X}_j) \right\vert \hspace{1cm} \text{(By Lemma \ref{cov:rewrite})} \nonumber\\
	&\le  n \left\vert (\bar{X}_i - \bar{X}_i')(\bar{X}_j - \bar{X}_j') \right\vert + \left\vert (y_i - \bar{X}_i)(y_j - \bar{X}_j) \right\vert \nonumber\\
	&\le \frac{n}{(n+1)^2} (M_i - m_i)(M_j - m_j) + \frac{n^2}{(n+1)^2} (M_i - m_i)(M_j - m_j) \nonumber	\\
	& \hspace{8cm} \text{(By Lemmas \ref{lemma:term1bound} and \ref{lemma:term2bound})} \nonumber\\
	&= \frac{n}{(n+1)}  (M_i - m_i)(M_j - m_j).
\end{align}

Removing a point:

Note that Lemma \ref{cov:rewrite} can be rewritten to this setting by parametrizing $n$ as $n-1$ and swapping X and X' in its expression:

$$ f_{ij}(X) = f_{ij}(X') + (n-1)(\bar{X}_i' - \bar{X}_i)(\bar{X}_j' - \bar{X}_j) + (y_i - \bar{X}_i')(y_j - \bar{X}_j'). $$

Note that Lemmas \ref{lemma:term1bound} and \ref{lemma:term2bound} may be rewritten with the same reparametrization:
$$ (n-1)\left\vert (\bar{X}_i' - \bar{X}_i)(\bar{X}_j' - \bar{X}_j) \right\vert \le \frac{n-1}{n^2} (M_i - m_i)(M_j - m_j),$$
and 
$$ \left\vert (y_i - \bar{X}_i')(y_j - \bar{X}_j') \right\vert \le \frac{(n-1)^2}{n^2}(M_i - m_i)(M_j - m_j).$$
Then,
\begin{align}
\label{eq:subone}
\left\vert f_{ij}(X) - f_{ij}(X') \right\vert &= \left\vert (n-1)(\bar{X}_i' - \bar{X}_i)(\bar{X}_j' - \bar{X}_j) + (y_i - \bar{X}_i')(y_j - \bar{X}_j') \right\vert, \nonumber\\
	&\le  \left\vert (n-1)(\bar{X}_i' - \bar{X}_i)(\bar{X}_j' - \bar{X}_j) \right\vert + \left\vert(y_i - \bar{X}_i')(y_j - \bar{X}_j') \right\vert, \nonumber\\
	&\le \frac{n-1}{n^2} (M_i - m_i)(M_j - m_j) + \frac{(n-1)^2}{n^2}(M_i - m_i)(M_j - m_j), \nonumber\\
	&= \frac{n-1}{n} (M_i - m_i)(M_j - m_j).
\end{align}

Note that for any $n \ge 1$,
	\begin{equation}
	\label{ineq}
	 \frac{n}{n + 1} > \frac{n-1}{n}.
	\end{equation}

So, the worst-case bound always occurs in the ``add-one'' case, and in general the  $\ell_1$ sensitivity of $f(\cdot)$ is bounded by
 $$ \frac{n}{(n+1)}  (M_i - m_i)(M_j - m_j).$$ 
\end{proof}

\begin{corollary}
The $\ell_1$-sensitivity of sample covariance is bounded by 
$$ \frac{n}{(n^2-1)}(M_i - m_i)(M_j - m_j).$$
\end{corollary}

\subsection{$\ell_2$-sensitivity}

\begin{theorem}
$f(\cdot)$ has $\ell_2$ sensitivity bounded above by 
$$\left(\frac{n}{(n^2-1)}(M_i - m_i)(M_j - m_j)\right)^2.$$
\end{theorem}

\begin{proof}
% note you can also do this directly by squaring the bounds and bounding the central term. I can add that in but it's just a lot of cluttered arithmetic. 
This follows from the bounds in Equations \ref{eq:addone} and \ref{eq:subone} and the inequality in Equation \ref{ineq}.
\end{proof}

\section{Neighboring Definition: Change One}
\subsection{$\ell_1$-sensitivity}

\subsection{$\ell_2$-sensitivity}

\bibliographystyle{alpha}
\bibliography{mean}

\end{document}