name:                validator-haskell
version:             0.1.0.0
github:              "privacytoolsproject/DP-Proposal"
license:             BSD3
author:              "privacytoolsproject"
#maintainer:          ""
#copyright:           "2019 privacytoolsproject"

description:         Validator for differential privacy analyses

build-type: Custom
extra-source-files:
- ../prototypes/**/*.proto
- README.md

dependencies:
- base >= 4.7 && < 5

#  options for compiling the library with position independent code and statically
# -Wall -fwarn-unused-imports -fPIC
#    ld-options: -static
#  static compilation hits a common bug for gcc wrappers like cabal on ubuntu
#  https://bugs.launchpad.net/ubuntu/+source/gcc-4.4/+bug/640734
#  more bugs exist in windows distros

# contents to inject directly to .cabal file
# (library block could be translated to hpack)
verbatim: |

  custom-setup
    setup-depends:        base, Cabal, proto-lens-setup

  library
    default-language: Haskell2010
    c-sources: csrc/DPValidatorWrapper.c
    hs-source-dirs:
      src
    exposed-modules:
      Validator
      Proto.Analysis
      Proto.Analysis_Fields
      Proto.Release
      Proto.Release_Fields
      Proto.Types
      Proto.Types_Fields
    build-depends:
      base >=4.11 && <4.13
      , bytestring
      , microlens
      , proto-lens
      , proto-lens-runtime
    ghc-options:
      -Wall -fwarn-unused-imports

  foreign-library Validator
    type:                native-shared
    lib-version-info:    6:3:2

    if os(Windows)
      options: standalone
      mod-def-file: DPValidator.def

    build-depends:
        validator-haskell
        , base >=4.11 && <4.13
        , bytestring
        , microlens
        , proto-lens
        , proto-lens-runtime
    default-language:    Haskell2010
    hs-source-dirs:      src
    c-sources:           csrc/DPValidatorWrapper.c